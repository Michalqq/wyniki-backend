{"version":3,"file":"911.js","mappings":"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","sources":["webpack://javascript/./src/components/page/AddPenaltyPage.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Selector } from \"../common/Selector\";\r\nimport axios from \"axios\";\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\n\r\nimport { backendUrl } from \"../utils/fetchUtils\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport authHeader from \"../../service/auth-header\";\r\nimport Button from \"react-bootstrap/Button\";\r\nimport { InputLabeled } from \"../common/InputLabeled\";\r\n\r\nexport const AddPenaltyPage = (props) => {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const eventId = location.state.eventId;\r\n\r\n  const [psOptions, setPsOptions] = useState([]);\r\n  const [teamOptions, setTeamOptions] = useState([]);\r\n  const [penaltyOptions, setPenaltyOptions] = useState([]);\r\n\r\n  const [teamId, setTeamId] = useState();\r\n  const [stage, setStage] = useState();\r\n\r\n  const [penalty, setPenalty] = useState({\r\n    penaltyDesc: \"\",\r\n    penaltyKind: null,\r\n  });\r\n\r\n  const [loadingTeams, setLoadingTeams] = useState(false);\r\n  const [disable, setDisable] = useState(false);\r\n  const [msg, setMsg] = useState();\r\n  const [customPenaltySec, setCustomPenaltySec] = useState(0);\r\n\r\n  const fetchPsOptions = () => {\r\n    axios\r\n      .get(`${backendUrl()}/event/getPsOptions?eventId=${eventId}`)\r\n      .then((res) => {\r\n        setPsOptions(res.data);\r\n        setStage(res.data[0]?.value);\r\n      });\r\n  };\r\n\r\n  const fetchPenaltyOptions = () => {\r\n    axios.get(`${backendUrl()}/penalty/getPenaltyOptions`).then((res) => {\r\n      setPenaltyOptions(res.data);\r\n    });\r\n  };\r\n\r\n  const fetchTeamsOptions = () => {\r\n    setLoadingTeams(true);\r\n    axios\r\n      .get(`${backendUrl()}/team/getTeamOptions?stageId=${stage}&mode=PENALTY`)\r\n      .then((res) => {\r\n        setTeamOptions(res.data);\r\n        setLoadingTeams(false);\r\n        setDisable(false);\r\n        if (res.data.length === 0) {\r\n          setDisable(true);\r\n        }\r\n      });\r\n  };\r\n\r\n  const postPenalty = (data, seconds) => {\r\n    axios\r\n      .post(`${backendUrl()}/penalty/addPenalty?seconds=${seconds}`, data, {\r\n        headers: authHeader(),\r\n      })\r\n      .then((res) => {\r\n        if (res.data === 1) {\r\n          const team = teamOptions.find((x) => x.value === data.teamId)?.label;\r\n          const penalty = penaltyOptions.find(\r\n            (x) => x.value === data.penaltyKind\r\n          );\r\n          setMsg(\r\n            `Dodano kare: ${penalty.label} ${\r\n              seconds !== 0 ? \";Liczba sekund: \" + seconds + \"s \" : \"\"\r\n            }; Kierowca:${team}`\r\n          );\r\n          setTimeout(() => setMsg(), 10000);\r\n        }\r\n      });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (eventId === undefined) navigate(\"/\");\r\n    fetchPenaltyOptions();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (eventId !== undefined) fetchPsOptions();\r\n  }, [eventId]);\r\n\r\n  useEffect(() => {\r\n    if (stage !== undefined) fetchTeamsOptions();\r\n  }, [stage]);\r\n\r\n  useEffect(() => {\r\n    if (teamOptions.length === 0) return;\r\n\r\n    const selectedTeam = teamOptions.find((x) => x.value === teamId);\r\n    setTeamId(selectedTeam ? selectedTeam?.value : teamOptions[0].value);\r\n  }, [teamOptions]);\r\n\r\n  useEffect(() => {\r\n    if (penaltyOptions.length > 0)\r\n      setPenalty({ ...penalty, penaltyKind: penaltyOptions[0].value });\r\n  }, [penaltyOptions]);\r\n\r\n  const addPenalty = () => {\r\n    const data = {\r\n      teamId: teamId,\r\n      stageId: stage,\r\n      penaltyKind: penalty.penaltyKind,\r\n      description: penalty.penaltyDesc,\r\n    };\r\n    postPenalty(data, customPenaltySec);\r\n    resetPenalty();\r\n  };\r\n\r\n  const resetPenalty = () => {\r\n    setPenalty({ ...penalty, penaltyDesc: \"\" });\r\n    setCustomPenaltySec(0);\r\n  };\r\n\r\n  const handleChange = (event) => {\r\n    setPenalty({ ...penalty, [event.target.name]: event.target.value });\r\n  };\r\n\r\n  return (\r\n    <div className=\"u-text-center\">\r\n      <div className=\"u-box-shadow\">\r\n        <div className=\"col-xl-12\">\r\n          <h5 className=\"pb-2 mb-1 border-bottom\">Dodaj kare:</h5>\r\n        </div>\r\n        <div className=\"row justify-content-center text-center\">\r\n          <div className=\"col-lg-4 pb-1\">\r\n            <Selector\r\n              label={\"Odcinek PS\"}\r\n              options={psOptions}\r\n              value={sessionStorage.getItem(\"refereeStageId\")}\r\n              handleChange={(value) => {\r\n                setStage(value);\r\n                sessionStorage.setItem(\"refereeStageId\", value);\r\n              }}\r\n              isValid={true}\r\n            />\r\n            <Selector\r\n              label={\"Załoga\"}\r\n              options={teamOptions}\r\n              value={teamId}\r\n              handleChange={(value) => setTeamId(value)}\r\n              isValid={true}\r\n              isLoading={loadingTeams}\r\n            />\r\n            <div className=\"d-flex\">\r\n              <div className=\"py-1\" style={{ width: \"100%\" }}>\r\n                <Selector\r\n                  label={\"Rodzaj kary\"}\r\n                  options={penaltyOptions}\r\n                  handleChange={(value) =>\r\n                    setPenalty({ ...penalty, penaltyKind: value })\r\n                  }\r\n                  isValid={true}\r\n                  isLoading={penaltyOptions.length === 0}\r\n                />\r\n              </div>\r\n              {penalty.penaltyKind === \"100\" && (\r\n                <div className=\"px-1\">\r\n                  <InputLabeled\r\n                    label=\"Kara w sekundach\"\r\n                    inputPlaceholder=\"00\"\r\n                    value={customPenaltySec}\r\n                    handleChange={(e) => setCustomPenaltySec(e.target.value)}\r\n                    onlyNumber={true}\r\n                    big={true}\r\n                    type={\"number\"}\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <textarea\r\n              placeholder={\"Dodatkowy opis\"}\r\n              value={penalty.penaltyDesc}\r\n              name=\"penaltyDesc\"\r\n              onChange={handleChange}\r\n              className={\"form-control centered-grid \"}\r\n              rows={2}\r\n              disabled={disable}\r\n            />\r\n            <div className=\"col-xl-12 pt-1\">\r\n              <button\r\n                type=\"button\"\r\n                className=\"btn btn-success mx-2 py-1\"\r\n                onClick={addPenalty}\r\n                disabled={disable || teamId === undefined}\r\n              >\r\n                Zapisz kare\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div className=\"col-lg-10 border-bottom\" style={{ height: \"40px\" }}>\r\n            <p className={\"px-0\"}>{msg}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"col-sm pt-1\"></div>\r\n      <Button\r\n        className={\"mx-2 py-1 px-2\"}\r\n        variant=\"primary\"\r\n        onClick={() =>\r\n          navigate(`/add_score`, {\r\n            state: { eventId: eventId },\r\n          })\r\n        }\r\n      >\r\n        Przejdź do dodawania wyników\r\n      </Button>\r\n      <Button\r\n        className={\"mx-2 py-1 px-2\"}\r\n        variant=\"success\"\r\n        onClick={() =>\r\n          navigate(`/event`, {\r\n            state: { eventId: eventId },\r\n          })\r\n        }\r\n      >\r\n        Wyniki\r\n      </Button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AddPenaltyPage;\r\n"],"names":["AddPenaltyPage","props","location","useLocation","navigate","useNavigate","eventId","state","useState","psOptions","setPsOptions","teamOptions","setTeamOptions","penaltyOptions","setPenaltyOptions","teamId","setTeamId","stage","setStage","penaltyDesc","penaltyKind","penalty","setPenalty","loadingTeams","setLoadingTeams","disable","setDisable","msg","setMsg","customPenaltySec","setCustomPenaltySec","useEffect","undefined","axios","backendUrl","then","res","data","value","length","selectedTeam","find","x","className","label","options","sessionStorage","getItem","handleChange","setItem","isValid","isLoading","style","width","inputPlaceholder","e","target","onlyNumber","big","type","placeholder","name","onChange","event","rows","disabled","onClick","seconds","stageId","description","headers","authHeader","team","setTimeout","height","variant"],"sourceRoot":""}